<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory & Sales Management System - Dubois Road Boutiques</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 500;
            color: #495057;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .alert-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .alert-box.success {
            background: #d4edda;
            border-color: #28a745;
        }

        .alert-box.danger {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
        }

        tbody tr {
            border-bottom: 1px solid #dee2e6;
            transition: background 0.3s;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .low-stock {
            background: #fff3cd !important;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #212529;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box input {
            flex: 1;
            min-width: 250px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .cart-item .qty-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .qty-controls button {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 5px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .receipt {
            background: white;
            padding: 30px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            max-width: 400px;
            margin: 0 auto;
        }

        .receipt h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #667eea;
        }

        .receipt-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .receipt-total {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            font-size: 2rem;
            cursor: pointer;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .nav-tab {
                padding: 12px 15px;
                font-size: 0.9rem;
            }

            .content {
                padding: 15px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 10px 8px;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideIn 0.5s;
            max-width: 400px;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíº Inventory & Sales Management System</h1>
            <p>Beauty & Fashion Accessories - Dubois Road, Nairobi</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="showTab('inventory')">üì¶ Inventory</button>
            <button class="nav-tab" onclick="showTab('sales')">üí∞ Sales</button>
            <button class="nav-tab" onclick="showTab('alerts')">üîî Alerts</button>
            <button class="nav-tab" onclick="showTab('reports')">üìà Reports</button>
        </div>

        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>Dashboard Overview</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Total Products</h3>
                        <div class="number" id="totalProducts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Low Stock Items</h3>
                        <div class="number" id="lowStockCount">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Today's Sales</h3>
                        <div class="number">KES <span id="todaySales">0</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Inventory Value</h3>
                        <div class="number">KES <span id="inventoryValue">0</span></div>
                    </div>
                </div>

                <div id="alertsContainer"></div>

                <h3>Recent Sales</h3>
                <div id="recentSales"></div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory" class="tab-content">
                <h2>Inventory Management</h2>
                
                <div class="search-box">
                    <input type="text" id="searchProduct" placeholder="üîç Search products..." onkeyup="filterProducts()">
                    <select id="filterCategory" onchange="filterProducts()">
                        <option value="">All Categories</option>
                        <option value="Jewelry">Jewelry</option>
                        <option value="Beauty Products">Beauty Products</option>
                        <option value="Hair Accessories">Hair Accessories</option>
                        <option value="Fashion Accessories">Fashion Accessories</option>
                    </select>
                    <button class="btn btn-primary" onclick="showAddProductModal()">‚ûï Add Product</button>
                </div>

                <table id="productTable">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Category</th>
                            <th>Price (KES)</th>
                            <th>Quantity</th>
                            <th>Threshold</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody"></tbody>
                </table>
            </div>

            <!-- Sales Tab -->
            <div id="sales" class="tab-content">
                <h2>Record New Sale</h2>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                    <div>
                        <div class="search-box">
                            <input type="text" id="searchSaleProduct" placeholder="üîç Search product to sell..." onkeyup="filterSaleProducts()">
                        </div>
                        
                        <div id="saleProductList"></div>
                    </div>

                    <div>
                        <h3>Shopping Cart</h3>
                        <div id="cart"></div>
                        
                        <div style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                            <h3>Total: KES <span id="cartTotal">0</span></h3>
                            
                            <div class="form-group">
                                <label>Payment Method</label>
                                <select id="paymentMethod" onchange="togglePaymentFields()">
                                    <option value="cash">Cash</option>
                                    <option value="mpesa">M-Pesa</option>
                                </select>
                            </div>

                            <div id="mpesaFields" style="display: none;">
                                <div class="form-group">
                                    <label>Customer Phone Number</label>
                                    <input type="tel" id="mpesaPhone" placeholder="0712345678">
                                </div>
                            </div>

                            <button class="btn btn-success" onclick="completeSale()" style="width: 100%; margin-top: 10px;">‚úì Complete Sale</button>
                            <button class="btn btn-secondary" onclick="clearCart()" style="width: 100%; margin-top: 10px;">‚úó Clear Cart</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts" class="tab-content">
                <h2>Low Stock Alerts</h2>
                <p>Products that need restocking (quantity below minimum threshold)</p>
                
                <div id="alertsList"></div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2>Sales & Inventory Reports</h2>
                
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Total Sales</h3>
                        <div class="number">KES <span id="reportTotalSales">0</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Transactions</h3>
                        <div class="number" id="reportTransactions">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Cash Payments</h3>
                        <div class="number">KES <span id="reportCash">0</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>M-Pesa Payments</h3>
                        <div class="number">KES <span id="reportMpesa">0</span></div>
                    </div>
                </div>

                <h3>Sales History</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Items</th>
                            <th>Total (KES)</th>
                            <th>Payment Method</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="salesHistoryBody"></tbody>
                </table>

                <h3 style="margin-top: 30px;">Best Selling Products</h3>
                <div id="bestSellers"></div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Product</h2>
                <span class="close-modal" onclick="closeModal('addProductModal')">&times;</span>
            </div>
            
            <div class="form-group">
                <label>Product Name *</label>
                <input type="text" id="productName" placeholder="e.g., Gold Hoop Earrings">
            </div>

            <div class="form-group">
                <label>Category *</label>
                <select id="productCategory">
                    <option value="Jewelry">Jewelry</option>
                    <option value="Beauty Products">Beauty Products</option>
                    <option value="Hair Accessories">Hair Accessories</option>
                    <option value="Fashion Accessories">Fashion Accessories</option>
                </select>
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea id="productDescription" rows="3" placeholder="Product details..."></textarea>
            </div>

            <div class="form-group">
                <label>Unit Price (KES) *</label>
                <input type="number" id="productPrice" placeholder="500" min="0">
            </div>

            <div class="form-group">
                <label>Initial Quantity *</label>
                <input type="number" id="productQuantity" placeholder="20" min="0">
            </div>

            <div class="form-group">
                <label>Minimum Threshold *</label>
                <input type="number" id="productThreshold" placeholder="5" min="0">
            </div>

            <button class="btn btn-primary" onclick="addProduct()">Add Product</button>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sale Receipt</h2>
                <span class="close-modal" onclick="closeModal('receiptModal')">&times;</span>
            </div>
            
            <div class="receipt" id="receiptContent"></div>
            
            <button class="btn btn-primary" onclick="printReceipt()" style="width: 100%; margin-top: 20px;">üñ®Ô∏è Print Receipt</button>
        </div>
    </div>

    <script>
        // Initialize sample data
        let products = [
            {id: 1, name: "Gold Hoop Earrings", category: "Jewelry", price: 800, quantity: 15, threshold: 5, description: "Elegant gold-plated hoop earrings"},
            {id: 2, name: "Red Lipstick - Matte", category: "Beauty Products", price: 350, quantity: 3, threshold: 5, description: "Long-lasting matte finish"},
            {id: 3, name: "Hair Clip Set", category: "Hair Accessories", price: 200, quantity: 25, threshold: 10, description: "Pack of 5 assorted clips"},
            {id: 4, name: "Silver Necklace", category: "Jewelry", price: 1500, quantity: 8, threshold: 3, description: "Sterling silver chain"},
            {id: 5, name: "Foundation - Medium", category: "Beauty Products", price: 950, quantity: 12, threshold: 5, description: "Full coverage foundation"},
            {id: 6, name: "Scrunchies Pack", category: "Hair Accessories", price: 150, quantity: 30, threshold: 10, description: "Set of 3 velvet scrunchies"},
            {id: 7, name: "Statement Earrings", category: "Jewelry", price: 600, quantity: 10, threshold: 5, description: "Bold fashion earrings"},
            {id: 8, name: "Mascara", category: "Beauty Products", price: 450, quantity: 4, threshold: 5, description: "Volumizing mascara"},
            {id: 9, name: "Leather Handbag", category: "Fashion Accessories", price: 2500, quantity: 5, threshold: 2, description: "Genuine leather bag"},
            {id: 10, name: "Sunglasses", category: "Fashion Accessories", price: 700, quantity: 8, threshold: 3, description: "UV protection glasses"}
        ];

        let sales = [];
        let cart = [];
        let nextProductId = 11;
        let nextSaleId = 1;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderProducts();
            renderDashboard();
            renderSaleProducts();
            renderAlerts();
            renderReports();
        });

        // Load data from localStorage
        function loadData() {
            const savedProducts = localStorage.getItem('products');
            const savedSales = localStorage.getItem('sales');
            
            if (savedProducts) products = JSON.parse(savedProducts);
            if (savedSales) sales = JSON.parse(savedSales);
            
            if (products.length > 0) {
                nextProductId = Math.max(...products.map(p => p.id)) + 1;
            }
            if (sales.length > 0) {
                nextSaleId = Math.max(...sales.map(s => s.id)) + 1;
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('sales', JSON.stringify(sales));
        }

        // Show tab
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') renderDashboard();
            if (tabName === 'inventory') renderProducts();
            if (tabName === 'sales') renderSaleProducts();
            if (tabName === 'alerts') renderAlerts();
            if (tabName === 'reports') renderReports();
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.remove(), 3000);
        }

        // Render Dashboard
        function renderDashboard() {
            const lowStockItems = products.filter(p => p.quantity <= p.threshold);
            const todaySales = sales.filter(s => {
                const saleDate = new Date(s.date);
                const today = new Date();
                return saleDate.toDateString() === today.toDateString();
            });
            const todaySalesTotal = todaySales.reduce((sum, s) => sum + s.total, 0);
            const inventoryValue = products.reduce((sum, p) => sum + (p.price * p.quantity), 0);

            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('lowStockCount').textContent = lowStockItems.length;
            document.getElementById('todaySales').textContent = todaySalesTotal.toFixed(2);
            document.getElementById('inventoryValue').textContent = inventoryValue.toFixed(2);

            // Show alerts
            const alertsContainer = document.getElementById('alertsContainer');
            if (lowStockItems.length > 0) {
                alertsContainer.innerHTML = `
                    <div class="alert-box danger">
                        <strong>‚ö†Ô∏è Low Stock Alert!</strong><br>
                        ${lowStockItems.length} product(s) need restocking: ${lowStockItems.map(p => p.name).join(', ')}
                    </div>
                `;
            } else {
                alertsContainer.innerHTML = `
                    <div class="alert-box success">
                        <strong>‚úì All Good!</strong> No low stock items.
                    </div>
                `;
            }

            // Recent sales
            const recentSalesDiv = document.getElementById('recentSales');
            if (sales.length === 0) {
                recentSalesDiv.innerHTML = '<p>No sales recorded yet.</p>';
            } else {
                const recent = sales.slice(-5).reverse();
                recentSalesDiv.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Total (KES)</th>
                                <th>Payment</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recent.map(s => `
                                <tr>
                                    <td>${new Date(s.date).toLocaleString()}</td>
                                    <td>${s.items.map(i => `${i.name} (${i.quantity})`).join(', ')}</td>
                                    <td>${s.total.toFixed(2)}</td>
                                    <td><span class="badge ${s.paymentMethod === 'mpesa' ? 'badge-success' : 'badge-warning'}">${s.paymentMethod === 'mpesa' ? 'M-Pesa' : 'Cash'}</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        // Render Products
        function renderProducts() {
            const tbody = document.getElementById('productTableBody');
            const filtered = filterProductsList();
            
            tbody.innerHTML = filtered.map(p => `
                <tr class="${p.quantity <= p.threshold ? 'low-stock' : ''}">
                    <td>${p.name}</td>
                    <td>${p.category}</td>
                    <td>${p.price.toFixed(2)}</td>
                    <td>${p.quantity}</td>
                    <td>${p.threshold}</td>
                    <td>
                        ${p.quantity <= p.threshold ? 
                            '<span class="badge badge-danger">Low Stock</span>' : 
                            '<span class="badge badge-success">In Stock</span>'}
                    </td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.85rem;" onclick="updateStock(${p.id})">Update</button>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85rem;" onclick="deleteProduct(${p.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Filter products
        function filterProducts() {
            renderProducts();
        }

        function filterProductsList() {
            const search = document.getElementById('searchProduct').value.toLowerCase();
            const category = document.getElementById('filterCategory').value;
            
            return products.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(search);
                const matchesCategory = !category || p.category === category;
                return matchesSearch && matchesCategory;
            });
        }

        // Show add product modal
        function showAddProductModal() {
            document.getElementById('addProductModal').classList.add('active');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Add product
        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value;
            const description = document.getElementById('productDescription').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const threshold = parseInt(document.getElementById('productThreshold').value);

            if (!name || !price || !quantity || !threshold) {
                showNotification('Please fill all required fields', 'error');
                return;
            }

            if (price < 0 || quantity < 0 || threshold < 0) {
                showNotification('Values must be positive', 'error');
                return;
            }

            const newProduct = {
                id: nextProductId++,
                name,
                category,
                description,
                price,
                quantity,
                threshold
            };

            products.push(newProduct);
            saveData();
            
            // Clear form
            document.getElementById('productName').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productQuantity').value = '';
            document.getElementById('productThreshold').value = '';
            
            closeModal('addProductModal');
            renderProducts();
            renderDashboard();
            showNotification('Product added successfully!', 'success');
            
            // Simulate Gava Connect alert if low stock
            if (quantity <= threshold) {
                setTimeout(() => {
                    showNotification(`üì± SMS Alert Sent: ${name} is low on stock!`, 'warning');
                }, 1000);
            }
        }

        // Update stock
        function updateStock(productId) {
            const product = products.find(p => p.id === productId);
            const newQty = prompt(`Update quantity for ${product.name}\nCurrent: ${product.quantity}`, product.quantity);
            
            if (newQty !== null) {
                const qty = parseInt(newQty);
                if (isNaN(qty) || qty < 0) {
                    showNotification('Invalid quantity', 'error');
                    return;
                }
                
                product.quantity = qty;
                saveData();
                renderProducts();
                renderDashboard();
                showNotification('Stock updated successfully!', 'success');
                
                // Check for low stock alert
                if (qty <= product.threshold) {
                    setTimeout(() => {
                        showNotification(`üì± SMS Alert: ${product.name} is low on stock (${qty} units)`, 'warning');
                    }, 500);
                }
            }
        }

        // Delete product
        function deleteProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (confirm(`Are you sure you want to delete "${product.name}"?`)) {
                products = products.filter(p => p.id !== productId);
                saveData();
                renderProducts();
                renderDashboard();
                showNotification('Product deleted successfully', 'success');
            }
        }

        // Render sale products
        function renderSaleProducts() {
            const div = document.getElementById('saleProductList');
            const filtered = filterSaleProductsList();
            
            if (filtered.length === 0) {
                div.innerHTML = '<p>No products available</p>';
                return;
            }
            
            div.innerHTML = filtered.map(p => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
                    <div>
                        <strong>${p.name}</strong><br>
                        <small>${p.category} - KES ${p.price.toFixed(2)}</small><br>
                        <small>Available: ${p.quantity}</small>
                    </div>
                    <button class="btn btn-primary" style="padding: 8px 15px;" onclick="addToCart(${p.id})" ${p.quantity === 0 ? 'disabled' : ''}>
                        ${p.quantity === 0 ? 'Out of Stock' : 'Add to Cart'}
                    </button>
                </div>
            `).join('');
        }

        function filterSaleProducts() {
            renderSaleProducts();
        }

        function filterSaleProductsList() {
            const search = document.getElementById('searchSaleProduct').value.toLowerCase();
            return products.filter(p => p.name.toLowerCase().includes(search) && p.quantity > 0);
        }

        // Add to cart
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const cartItem = cart.find(c => c.id === productId);
            
            if (cartItem) {
                if (cartItem.quantity >= product.quantity) {
                    showNotification('Not enough stock available', 'error');
                    return;
                }
                cartItem.quantity++;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    maxQty: product.quantity
                });
            }
            
            renderCart();
            showNotification(`${product.name} added to cart`, 'success');
        }

        // Render cart
        function renderCart() {
            const cartDiv = document.getElementById('cart');
            
            if (cart.length === 0) {
                cartDiv.innerHTML = '<p style="text-align: center; color: #6c757d;">Cart is empty</p>';
                document.getElementById('cartTotal').textContent = '0.00';
                return;
            }
            
            cartDiv.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>KES ${item.price.toFixed(2)} √ó ${item.quantity}</small>
                    </div>
                    <div class="qty-controls">
                        <button onclick="updateCartQty(${item.id}, -1)">-</button>
                        <span style="font-weight: bold;">${item.quantity}</span>
                        <button onclick="updateCartQty(${item.id}, 1)">+</button>
                        <button onclick="removeFromCart(${item.id})" style="background: #dc3545;">√ó</button>
                    </div>
                </div>
            `).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cartTotal').textContent = total.toFixed(2);
        }

        // Update cart quantity
        function updateCartQty(productId, change) {
            const cartItem = cart.find(c => c.id === productId);
            cartItem.quantity += change;
            
            if (cartItem.quantity <= 0) {
                removeFromCart(productId);
                return;
            }
            
            if (cartItem.quantity > cartItem.maxQty) {
                showNotification('Not enough stock available', 'error');
                cartItem.quantity = cartItem.maxQty;
            }
            
            renderCart();
        }

        // Remove from cart
        function removeFromCart(productId) {
            cart = cart.filter(c => c.id !== productId);
            renderCart();
        }

        // Clear cart
        function clearCart() {
            if (cart.length === 0) return;
            if (confirm('Clear all items from cart?')) {
                cart = [];
                renderCart();
                showNotification('Cart cleared', 'success');
            }
        }

        // Toggle payment fields
        function togglePaymentFields() {
            const method = document.getElementById('paymentMethod').value;
            document.getElementById('mpesaFields').style.display = method === 'mpesa' ? 'block' : 'none';
        }

        // Complete sale
        function completeSale() {
            if (cart.length === 0) {
                showNotification('Cart is empty', 'error');
                return;
            }
            
            const paymentMethod = document.getElementById('paymentMethod').value;
            let mpesaPhone = '';
            
            if (paymentMethod === 'mpesa') {
                mpesaPhone = document.getElementById('mpesaPhone').value.trim();
                if (!mpesaPhone) {
                    showNotification('Please enter phone number for M-Pesa', 'error');
                    return;
                }
                
                // Validate phone format
                if (!/^07\d{8}$/.test(mpesaPhone)) {
                    showNotification('Invalid phone number format. Use 07XXXXXXXX', 'error');
                    return;
                }
                
                // Simulate STK Push
                showNotification('üì± Sending M-Pesa STK Push...', 'warning');
                
                setTimeout(() => {
                    showNotification('‚úì M-Pesa payment received!', 'success');
                    processSale(paymentMethod, mpesaPhone);
                }, 2000);
            } else {
                processSale(paymentMethod, '');
            }
        }

        // Process sale
        function processSale(paymentMethod, mpesaPhone) {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Create sale record
            const sale = {
                id: nextSaleId++,
                date: new Date().toISOString(),
                items: cart.map(c => ({...c})),
                total: total,
                paymentMethod: paymentMethod,
                mpesaPhone: mpesaPhone,
                transactionRef: paymentMethod === 'mpesa' ? 'MPE' + Math.random().toString(36).substr(2, 9).toUpperCase() : '',
                status: 'completed'
            };
            
            sales.push(sale);
            
            // Update inventory
            cart.forEach(cartItem => {
                const product = products.find(p => p.id === cartItem.id);
                product.quantity -= cartItem.quantity;
                
                // Check low stock
                if (product.quantity <= product.threshold) {
                    setTimeout(() => {
                        showNotification(`‚ö†Ô∏è Low Stock Alert: ${product.name} (${product.quantity} left)`, 'warning');
                    }, 1000);
                }
            });
            
            saveData();
            
            // Show receipt
            showReceipt(sale);
            
            // Clear cart and reset form
            cart = [];
            document.getElementById('mpesaPhone').value = '';
            renderCart();
            renderDashboard();
            renderSaleProducts();
            
            showNotification('Sale completed successfully!', 'success');
        }

        // Show receipt
        function showReceipt(sale) {
            const receiptContent = document.getElementById('receiptContent');
            
            receiptContent.innerHTML = `
                <h2>üè™ Beauty Corner Shop</h2>
                <p style="text-align: center; color: #6c757d; margin-bottom: 20px;">Dubois Road, Nairobi</p>
                
                <div style="margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #dee2e6;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Receipt #:</span>
                        <strong>${String(sale.id).padStart(6, '0')}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Date:</span>
                        <span>${new Date(sale.date).toLocaleString()}</span>
                    </div>
                </div>
                
                <table style="width: 100%; margin-bottom: 20px;">
                    <thead>
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <th style="text-align: left; padding: 5px;">Item</th>
                            <th style="text-align: right; padding: 5px;">Qty</th>
                            <th style="text-align: right; padding: 5px;">Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sale.items.map(item => `
                            <tr>
                                <td style="padding: 5px;">${item.name}</td>
                                <td style="text-align: right; padding: 5px;">${item.quantity}</td>
                                <td style="text-align: right; padding: 5px;">${(item.price * item.quantity).toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div class="receipt-total">
                    <div style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 2px solid #667eea;">
                        <span>TOTAL:</span>
                        <span>KES ${sale.total.toFixed(2)}</span>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Payment Method:</span>
                        <strong>${sale.paymentMethod === 'mpesa' ? 'M-Pesa' : 'Cash'}</strong>
                    </div>
                    ${sale.paymentMethod === 'mpesa' ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Phone:</span>
                            <span>${sale.mpesaPhone}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Transaction Ref:</span>
                            <span><strong>${sale.transactionRef}</strong></span>
                        </div>
                    ` : ''}
                </div>
                
                <p style="text-align: center; margin-top: 30px; color: #667eea; font-weight: bold;">
                    Thank you for your purchase!
                </p>
                <p style="text-align: center; color: #6c757d; font-size: 0.85rem;">
                    Visit us again soon!
                </p>
            `;
            
            document.getElementById('receiptModal').classList.add('active');
        }

        // Print receipt
        function printReceipt() {
            window.print();
        }

        // Render alerts
        function renderAlerts() {
            const lowStockItems = products.filter(p => p.quantity <= p.threshold);
            const alertsList = document.getElementById('alertsList');
            
            if (lowStockItems.length === 0) {
                alertsList.innerHTML = `
                    <div class="alert-box success">
                        <strong>‚úì All Products Well Stocked</strong><br>
                        No low stock items at this time.
                    </div>
                `;
                return;
            }
            
            alertsList.innerHTML = `
                <div class="alert-box danger" style="margin-bottom: 20px;">
                    <strong>‚ö†Ô∏è ${lowStockItems.length} Product(s) Need Restocking</strong>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Category</th>
                            <th>Current Qty</th>
                            <th>Threshold</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${lowStockItems.map(p => `
                            <tr class="low-stock">
                                <td>${p.name}</td>
                                <td>${p.category}</td>
                                <td><strong style="color: #dc3545;">${p.quantity}</strong></td>
                                <td>${p.threshold}</td>
                                <td>
                                    <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.85rem;" onclick="sendGavaAlert('${p.name}', ${p.quantity}, ${p.threshold})">
                                        üì± Send SMS Alert
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Simulate Gava Connect SMS alert
        function sendGavaAlert(productName, quantity, threshold) {
            showNotification('üì° Connecting to Gava Connect API...', 'warning');
            
            setTimeout(() => {
                const message = `LOW STOCK ALERT: ${productName} has only ${quantity} units left. Minimum required: ${threshold}. Please restock soon. - Beauty Corner Shop`;
                showNotification(`‚úì SMS Sent via Gava Connect!\n\nMessage: "${message}"`, 'success');
            }, 1500);
        }

        // Render reports
        function renderReports() {
            const totalSales = sales.reduce((sum, s) => sum + s.total, 0);
            const cashSales = sales.filter(s => s.paymentMethod === 'cash').reduce((sum, s) => sum + s.total, 0);
            const mpesaSales = sales.filter(s => s.paymentMethod === 'mpesa').reduce((sum, s) => sum + s.total, 0);
            
            document.getElementById('reportTotalSales').textContent = totalSales.toFixed(2);
            document.getElementById('reportTransactions').textContent = sales.length;
            document.getElementById('reportCash').textContent = cashSales.toFixed(2);
            document.getElementById('reportMpesa').textContent = mpesaSales.toFixed(2);
            
            // Sales history
            const salesHistoryBody = document.getElementById('salesHistoryBody');
            if (sales.length === 0) {
                salesHistoryBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No sales recorded yet</td></tr>';
            } else {
                salesHistoryBody.innerHTML = sales.slice().reverse().map(s => `
                    <tr>
                        <td>${new Date(s.date).toLocaleString()}</td>
                        <td>${s.items.map(i => `${i.name} (${i.quantity})`).join(', ')}</td>
                        <td>${s.total.toFixed(2)}</td>
                        <td><span class="badge ${s.paymentMethod === 'mpesa' ? 'badge-success' : 'badge-warning'}">${s.paymentMethod === 'mpesa' ? 'M-Pesa' : 'Cash'}</span></td>
                        <td><span class="badge badge-success">${s.status}</span></td>
                    </tr>
                `).join('');
            }
            
            // Best sellers
            const productSales = {};
            sales.forEach(sale => {
                sale.items.forEach(item => {
                    if (!productSales[item.name]) {
                        productSales[item.name] = { name: item.name, quantity: 0, revenue: 0 };
                    }
                    productSales[item.name].quantity += item.quantity;
                    productSales[item.name].revenue += item.price * item.quantity;
                });
            });
            
            const bestSellers = Object.values(productSales).sort((a, b) => b.quantity - a.quantity).slice(0, 5);
            
            const bestSellersDiv = document.getElementById('bestSellers');
            if (bestSellers.length === 0) {
                bestSellersDiv.innerHTML = '<p>No sales data available yet</p>';
            } else {
                bestSellersDiv.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Product Name</th>
                                <th>Units Sold</th>
                                <th>Revenue (KES)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${bestSellers.map((p, i) => `
                                <tr>
                                    <td><strong>${i + 1}</strong></td>
                                    <td>${p.name}</td>
                                    <td>${p.quantity}</td>
                                    <td>${p.revenue.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }
    </script>
</body>
</html>